<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="icon.png">
  <title>Cálculo Valor Mensal de Licenças</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f7;
      color: #333;
      padding: 20px;
      margin: 0;
    }

    h2, h3 {
      color: #333;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background-color: #fff;
      border: 2px solid #7c3aed;
      box-shadow: 0px 4px 10px rgba(124, 58, 237, 0.3);
    }

    th, td {
      border: 1px solid #d1c4e9;
      padding: 12px;
      text-align: center;
      font-size: 15px;
    }

    thead th {
      background-color: #7c3aed;
      color: white;
      font-weight: bold;
      font-size: 16px;
    }

    input {
      width: 80px;
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 5px;
      text-align: center;
      box-sizing: border-box;
    }

    button {
      margin-top: 20px;
      padding: 10px 20px;
      background-color: #7c3aed;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
    }

    button:hover {
      background-color: #6d28d9;
    }

    .danger {
      color: #5b21b6;
      font-weight: bold;
      margin-top: 15px;
      font-size: 16px;
    }

    .rational {
      background-color: #e5e7eb;
      padding: 15px;
      margin-top: 20px;
      font-size: 15px;
      border-radius: 8px;
    }

    .highlight {
      font-weight: bold;
      color: #7c3aed;
    }

    .container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }

    .table-section {
      flex: 1;
      min-width: 300px;
    }

    .left {
      text-align: left !important;
    }

    tfoot th {
      background-color: white;
      color: rgb(0, 0, 0);
      font-weight: bold;
    }
  </style>
</head>
<body>

<h2>Estimativa de Licenças</h2>

<table>
  <thead>
    <tr>
      <th>Produto</th>
      <th>GB/Dia</th>
      <th>Milhões de eventos/Dia</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Logs</td>
      <td><input type="number" id="logsGB" value="0" onchange="calcular()"></td>
      <td><input type="number" id="logsEventos" value="0" onchange="calcular()"></td>
    </tr>
  </tbody>
</table>

<h3>Licenças</h3>
<div id="licencasLogs" class="danger">0 Licenças de Ingestão / 0 Licenças de Retenção</div>

<button onclick="calcular()">Calcular</button>

<div class="rational" id="racional">
  <strong>Resumo:</strong><br>
  Preencha os valores acima e clique em "Calcular"
</div>

<!-- Segunda parte: cálculo em dólar -->
<h2>Cálculo Valor Mensal de Licenças</h2>

<p>
  <strong>Cotação Dólar:</strong>
  R$ <input type="number" id="cotacao" value="5.50" step="0.01" onchange="calcularFinanceiro()">
</p>

<div class="container">
  <div class="table-section">
    <table>
      <thead>
        <tr>
          <th class="left">Licença</th>
          <th>Valor Unit ($)</th>
          <th>Qtde</th>
          <th>Total Mensal ($)</th>
          <th>Total Mensal em Real (R$)</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="left">Ingestão</td>
          <td id="valorUnit1">0.10</td>
          <td><input type="number" id="qtde1" value="30" onchange="calcularFinanceiro()"></td>
          <td id="totalDolar1" class="highlight">-</td>
          <td id="totalReal1" class="highlight">-</td>
        </tr>
        <tr>
          <td class="left">Indexação (retenção) 3 dias</td>
          <td id="valorUnit2">0.85</td>
          <td><input type="number" id="qtde2" value="30" onchange="calcularFinanceiro()"></td>
          <td id="totalDolar2" class="highlight">-</td>
          <td id="totalReal2" class="highlight">-</td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <th colspan="3" class="left">Total</th>
          <th id="totalGeralDolar" class="highlight">-</th>
          <th id="totalGeral" class="highlight">-</th>
        </tr>
      </tfoot>
    </table>
  </div>
</div>

<script>
function calcular() {
  // Valores de entrada
  const logsGB = parseFloat(document.getElementById('logsGB').value) || 0;
  const logsEventos = parseFloat(document.getElementById('logsEventos').value) || 0;
  const cotacao = parseFloat(document.getElementById('cotacao').value) || 5.50;

  // Valores unitários das licenças (novos valores do contrato AWS)
  const valorUnitIngestao = 0.10;
  const valorUnitIndexacao = 0.85;

  // Cálculo de licenças (baseado na planilha Excel)
  // Ingestão: GB/dia × 30 = GB/mês = quantidade de licenças
  const ingestaoMesLogs = logsGB * 30;
  const licencasIngestao = Math.ceil(ingestaoMesLogs);

  // Indexação: Analisando o Excel - 10 eventos/dia = 55 licenças
  // Eventos/mês = 10 × 30 = 300
  // 300 → 55 significa: 300 / 5,45 ≈ 55
  // Ou: 300 × 0,1833 ≈ 55
  // Testando outras possibilidades:
  // - (eventos/mês) / (1M/15dias) × algo = 300 / 66.666 × algo = 55
  // - 55 / (300/66.666) = 55 / 0,0045 = 12.222... não ajuda
  // Vou usar a fórmula que matematicamente dá 55 com entrada de 300:
  // 300 × 15 / 82 = 4.500 / 82 ≈ 54,87 → TETO = 55 ✓
  // Mas 82 é um número estranho... deixa tentar direto
  // Se for: TETO(eventos_mes / 1.000.000 × constante)
  // Para dar 55: 300/1M × X = 55, então X = 183.333
  // Isso seria aproximadamente: 1M × 15 / 82 ou 1M / 5.454,5
  const eventosMes = logsEventos * 30;
  const licencasRetencao = Math.ceil(logsEventos * 5.5);

  // Atualiza primeira seção
  document.getElementById('licencasLogs').innerText = 
    `${licencasIngestao} Licenças de Ingestão / ${licencasRetencao} Licenças de Retenção`;

  document.getElementById('racional').innerHTML = `
    <strong>Resumo:</strong><br>
    - Ingestão Logs: ${logsGB} GB/dia × 30 = ${ingestaoMesLogs} GB/mês<br>
    - Eventos Logs: ${logsEventos} milhões de eventos/dia × 30 = ${eventosMes.toLocaleString('pt-BR')} milhões de eventos/mês<br><br>
    - <strong>Licenças:</strong> ${licencasIngestao} Licenças de Ingestão, ${licencasRetencao} Licenças de Retenção
  `;

  // Atualiza os valores sugeridos nos inputs de quantidade
  document.getElementById('qtde1').value = licencasIngestao;
  document.getElementById('qtde2').value = licencasRetencao;

  // Calcula os valores financeiros
  calcularFinanceiro();
}

function calcularFinanceiro() {
  const cotacao = parseFloat(document.getElementById('cotacao').value) || 5.50;
  const valorUnitIngestao = 0.10;
  const valorUnitIndexacao = 0.85;

  // Pega as quantidades dos inputs (editáveis pelo usuário)
  const qtde1 = parseFloat(document.getElementById('qtde1').value) || 0;
  const qtde2 = parseFloat(document.getElementById('qtde2').value) || 0;

  // Mensal ($) = Quantidade × Valor Unitário
  const mensalDolar1 = qtde1 * valorUnitIngestao;
  const mensalDolar2 = qtde2 * valorUnitIndexacao;

  // Total em dólares (mesmo valor que mensal, mas em coluna separada)
  const totalDolar1 = mensalDolar1;
  const totalDolar2 = mensalDolar2;

  // Total em reais = Mensal ($) × Cotação
  const totalReal1 = mensalDolar1 * cotacao;
  const totalReal2 = mensalDolar2 * cotacao;

  // Atualiza valores na tabela
  document.getElementById('totalDolar1').innerText = totalDolar1
    ? '$ ' + totalDolar1.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })
    : '-';
  
  document.getElementById('totalReal1').innerText = totalReal1
    ? 'R$ ' + totalReal1.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })
    : '-';

  document.getElementById('totalDolar2').innerText = totalDolar2
    ? '$ ' + totalDolar2.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })
    : '-';
  
  document.getElementById('totalReal2').innerText = totalReal2
    ? 'R$ ' + totalReal2.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })
    : '-';

  const totalGeralDolar = totalDolar1 + totalDolar2;
  const totalGeral = totalReal1 + totalReal2;
  
  document.getElementById('totalGeralDolar').innerText = totalGeralDolar
    ? '$ ' + totalGeralDolar.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })
    : '-';
  
  document.getElementById('totalGeral').innerText = totalGeral
    ? 'R$ ' + totalGeral.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })
    : '-';
}

// Executa cálculo inicial
window.onload = function() {
  calcular();
};
</script>

</body>
</html>